<!-- Template for the main document selection table.
If initial load times turn out to be an issue, it may be a better idea to inline this template into the main index.html file to avoid the extra roundtrip. -->

<form class='form-inline' role='form'>
  <div id='lectureSelection' class='form-group'>
    <label for='lectureName' class='sr-only'>Vorlesung</label>
    <input id='lectureName' placeholder='Vorlesung (Regex oder Initialen (MMMK, TeIn, ...))' type='text' class='form-control-inline form-control input-lg' data-bind='value: lecture.name, typeahead: { options: { highlight: true }, dataset: { source: lectures.typeaheadFilter.bind(lectures), displayKey: "name" } }, valueUpdate: ["typeahead:autocompleted", "typeahead:selected"]' autofocus>
  </div>
</form>
<table class="table table-condensed">
  <thead>
    <tr>
      <td>#</td>
      <td>Vorlesungen</td>
      <td>Prüfer</td>
      <td>Prüfungsart</td>
      <td>Datum</td>
      <td>Seiten</td>
      <td>Komm.</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td><input type='text' data-bind='value: lecture.lecturesFilter, valueUpdate: "input"' class='form-control form-control-inline input-sm' placeholder='Filter (regex)'></td>
      <td><input type='text' data-bind='value: lecture.examinantsFilter, valueUpdate: "input"' class='form-control form-control-inline input-sm' placeholder='Filter (regex)'></td>
      <td>
        <select data-bind='value: lecture.typeFilter'>
          <option value=''>Beides</option>
          <option value='written'>Schriftlich</option>
          <option value='oral'>Mündlich</option>
        </select>
      </td>
      <td></td>
      <td></td>
      <td></td>
      <td class='text-right'><button class='icon-button btn-info btn' title="Alle hinzufügen" data-bind="click: $root.cart.addAll.bind($root.cart, $root.lecture.filtered())">∀<span class='icon-basket small'></span></button></td>
    </tr>
  </thead>
  <tbody data-bind="foreach: lecture.filtered()">
  <tr class="document-list" data-bind="
    css: { 'row-disabled': !$root.cart.doesntContain($data) },
    event: { mouseenter: $root.rangeSelect.onRowMouseOver.bind($root.rangeSelect, $index) },
    click: $root.rangeSelect.onClick.bind($root.rangeSelect, $index, $root.lecture.filtered())">
    <td class="rangeBar-td" data-bind="css: { 'rangeBar-selected addButton-color': $root.rangeSelect.selectedBarVisible($index)}">
      <span class="rangeBar-bound rangeBar-upper-bound icon-down-open" data-bind="visible: $root.rangeSelect.upperBoundVisible($index)"></span>
      <span class="row-disabled" data-bind="text: $index() + 1"></span>
      <span class="rangeBar-bound rangeBar-lower-bound icon-up-open" data-bind="visible: $root.rangeSelect.lowerBoundVisible($index)"></span>
    </td>
    <td>
      <div class="lecture-list-cell" data-bind="foreach: {data: lectures, as: 'lect'}">
        <div data-bind="text: '• ' + lect"></div>
      </div>
    </td>

    <td data-bind="text: examinants.join(', ')"></td>
    <td data-bind="text: displayExamType()"></td>
    <td class="td-nowrap" data-bind="text: displayDate()"></td>
    <td data-bind="text: pages"></td>
    <td class="text-center">
      <div data-bind="visible: comment !== '', attr: {title: comment}" class="icon-dot-circled"></div>
      <div data-bind="visible: comment === ''" class="icon-circle-empty"></div></td>
    <td class="td-nowrap td-compact text-right">
      <button
        class='icon-button btn-info btn btn-compact icon-basket'
        data-bind="
        click: $root.rangeSelect.commit.bind($root.rangeSelect, $root.lecture.filtered()),
        style:
        { visibility: $root.rangeSelect.toggleButtonVisible($index) ? 'visible' : 'hidden' },
        clickBubble: false,
        enable: $root.cart.doesntContain($data)">
      </button>
      <button
        class='icon-button btn-info btn btn-compact icon-eye'
        title="Vorschau (von Fachschaftsrechnern aus)"
        data-toggle="modal"
        data-target="#preview-config"
        data-bind="
        visible: $root.user.isAuthenticated & !$root.isPreviewConfigured,
        style: { visibility: $index() == $root.rangeSelect.hoverIndex ? 'visible' : 'hidden' },
        "></button>
      <a
        class='icon-button btn-info btn btn-compact icon-eye'
        title="Vorschau (von Fachschaftsrechnern aus)"
        target="_blank"
        data-bind="
        attr: { href: 'file://' + $root.previewPrefix + path },
        click: function() { return true; },
        clickBubble: false,
        visible: $root.user.isAuthenticated & $root.isPreviewConfigured,
        style: { visibility: $index() == $root.rangeSelect.hoverIndex ? 'visible' : 'hidden' },
        "></a>
    </td>
  </tr>
  </tbody>
</table>

